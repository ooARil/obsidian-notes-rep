### Внедрение зависимостей с помощью конструктора

По-умолчанию при создании bean-а в xml, объект внедряется с помощью пустого конструктора (который создан неявно):
![[Pasted image 20240127221552.png]]
![[Pasted image 20240127012821.png]]

Но в случае, если у нас есть зависимости в объекте, то в xml-будет сообщение об ошибки, т.к. конструктор без параметров не может быть найден:
![[Pasted image 20240127211900.png]]
![[Pasted image 20240127211918.png]]

Поэтому необходимо описать следующим способом:
![[Pasted image 20240127212211.png]]
Замечание: Самое главное это соблюдать порядок, т.к. иначе будет ошибка компиляции.
Пояснение: Значения "postgres" и "10" будут автоматически приведены к нужным типам, т.е. к String и к Integer.

И если мы попытаемся получить бин из *BeanFactory*, увидим что все значения из xml были подставлены в параметры конструктора и про инициализировались (т.е. произошло "внедрение зависимостей через конструктор")
![[Pasted image 20240127212818.png]]

Важный момент:
В beanFactory->beanDefinitonMap (мапа с бинами) -> genericBeanDefinition (наш бин) есть поле *constructArgumentsValues* - данный объект содержит лист *genericArgumentValues*, который и содержит все наши перечисленные значения из xml:
![[Pasted image 20240127213647.png]]
![[Pasted image 20240127213733.png]]
Пояснение: Т.е. сначала все аргументы, который были описаны в бине в тэгах $<contstructor-arg>$ записываются в лист, после чего передаются в конструктор для создания объекта с типом указанным в бине.

---

### Указание соответствия аргумента конструктора с его параметром с помощью индекса 

Но такой порядок в xml трудно поддерживать, поэтому для этого существует такой объект как indexedArgumentValues.
В xsd схемы beans есть такой элемент как indexed в тэге $<constructor-arg>$, который позволяет указать, что данное значение соответствует конкретному параметру по счету (индексу)
![[Pasted image 20240127214633.png]]
И в этом случае аргументы конструктора заданные в xml будут уже лежать не в листе, а в LinkedHashMap (где key-это индекс, а value-genericBeanDefinition):
![[Pasted image 20240127214750.png]]
![[Pasted image 20240127214815.png]]

---

### Указание соответствия аргумента конструктора с его параметром с помощью его типа (в ситуации если в классе несколько конструкторов с одним параметром)

Кроме того, можно дополнительно себя обезопасить, а именно добавить соответствие типов аргументов конструктора:
![[Pasted image 20240127215235.png]]
Замечание: Важно чтобы данные типы совпадали с типом параметров в конструкторе.
Пояснение: Однако в нашем примере с ConnectionPool это делать не нужно, т.к. мы придерживаемся индексов и у нас всего один конструктор в ConnectionPool.
* Но если у нас несколько конструкторов, которые принимают равное количество параметров, но они разного типа, то мы должны указывать конкретный тип аргумента, чтобы Spring знал, какой конкретно конструктор нужно вызывать:

	Например если мы хотим создать бин класса String, у которого много конструкторов, содержащих один параметр:
	![[Pasted image 20240127220444.png]]
	Нужно указать конкретный тип аргумента, чтобы Spring вызвал нужный параметр:
	![[Pasted image 20240127220602.png]]
	Можно увидеть, что в genereicDefinitionBean теперь указан конкретный тип аргумента:
	![[Pasted image 20240127220844.png]]


---

### Указание соответствия аргумента конструктора с его параметром с помощью его имени

Также помимо порядка, индекса, типа, провести соответствие с нужным параметром конструктора можно и с помощью его имени:
![[Pasted image 20240127221134.png]]
Что гораздо удобнее и теперь в genericDefinitionBean, указано конкретное имя параметра:
![[Pasted image 20240127221257.png]]

---

### Также можно помимо обычных джавовских типов и своих типов, можно указывать бины

![[Pasted image 20240127223134.png]]
![[Pasted image 20240127223339.png]]
Пояснение: Для этого нужно просто в воспользоваться ключевым словом *ref* (ссылка на бин):
![[Pasted image 20240127223238.png]]
И помощник сразу же предложит все доступные нам бины.

Из-за того что идет ссылка на бин, в поле genericArgumentsValues теперь описывается следующая информация:
![[Pasted image 20240127224544.png]]
Пояснение: Т.е. используется объект RuntimeBeanReference, который содержит всю информацию о бине, на который идет ссылка.