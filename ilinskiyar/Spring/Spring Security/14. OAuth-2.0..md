Очень неудобно для пользователя, что приходиться помнить пароль от каждого приложения:
![[Pasted image 20240524164048.png]]
и кроме того не все приложения гарантируют безопасность наших данных, которые хранятся в базе данных.
Пояснение: Т.е. иногда пользователи используют одинаковые пароли, поэтому если приложение хранит не защищенные пароли, они могут быть использованы, для того, чтобы войти в другие приложения пользователи для кражи личных данных.

Поэтому принимая как факт данные минусы, - есть еще один способ аутентификации и авторизации наших пользователей. А именно использование oauth 2:
![[Pasted image 20240524183559.png]]

---

### Что такое OAuth-2.0. ?

OAuth 2 – это протокол авторизации, который используется для управления доступом к данным пользователя на одном сервисе, который, в свою очередь, предоставляется клиентским приложениям на другом сервисе. 

Клиентскими приложениями могут быть веб-сервисы, мобильные или десктопные приложения, а сервисами могут быть различные платформы (например, mail.ru).

---

### Основные компоненты OAuth-2.0.

OAuth2 определяет четыре основных компонента, которые играют ключевую роль в процессе авторизации и доступа к данным:

1. **Resource Owner** (владелец ресурса) - это пользователь, который имеет доступ к защищенным ресурсам и может разрешить третьим лицам (клиентам) получить доступ к этим ресурсам. 
	Пояснение: Если в качестве сервиса авторизации мы выбрали Google, то это пользователь Google, который может разрешить вашему приложению получить доступ к его данным, например, к его календарю или контактам.
    
2. **Client** (клиент) - это приложение, которое запрашивает доступ к защищенным ресурсам владельца ресурса. 
	Пояснение: В нашем случае, это приложение на Spring Boot, которое хочет получить доступ к данным пользователя Google.
    
3. **Authorization Server** (сервер авторизации) - это сервер, который проверяет удостоверения пользователя и выдает токены доступа клиенту. 
	Пояснение: В случае с Google, это сервер, который обрабатывает запросы на аутентификацию и авторизацию от вашего приложения.
    
4. **Resource Server** (сервер ресурсов) - это сервер, который хранит защищенные ресурсы и принимает и проверяет токены доступа, выданные сервером авторизации. 
	Пояснение: Для Google это сервер, который хранит данные пользователя и предоставляет доступ к ним через API.

Таким образом, OAuth2 позволяет разделить ответственность между этими компонентами и обеспечивает безопасный и гибкий способ управления доступом к данным пользователей через различные приложения и сервисы.

---

### Как работает OAuth-2.0. ?

Последовательность действий в работе клиентского приложения может изменяться в зависимости от требований и логики бизнес-процесса.

![[Pasted image 20240526225514.png]]

Пояснение:
1. Клиент запрашивает у пользователя доступ к его данным на ресурсном сервере.
2. Пользователь предоставляет доступ клиенту через сервер авторизации, войдя в приложение под своими учетными данными. Однако они не передаются клиенту. Вместо этого генерируется код авторизации, который отправляется напрямую клиенту.
3. Клиент использует этот код авторизации для запроса токена доступа от конечной точки, предоставленной сервером авторизации.
4. Сервер авторизации генерирует и возвращает токен доступа, который клиент может использовать для доступа к ресурсам пользователя на ресурсном сервере.
5. Клиент отправляет токен доступа на ресурсный сервер, чтобы запросить доступ к ресурсам пользователя.
6. Тот проверяет токен доступа на авторизационном сервере. Если токен действителен, он предоставляет клиенту доступ к ресурсам пользователя.


---

### Регистрация приложения на сервере API (например: Google)


![[Pasted image 20240526232356.png]]

Для того, чтобы у нас происходило общение между клиентом и сервером авторизации - необходимо сначала зарегистрировать наше приложение на сервере авторизации (например: Google).
	
После регистрации будут предоставлены два ключа: 
1. **client_id** (идентификатор клиента). Используется для идентификации вашего приложения и для создания авторизационных URL для пользователей. Это открытая информация.

2. **client_secret** (секрет клиента). Необходим для проверки подлинности вашего приложения API сервисом в момент, когда оно запрашивает доступ к аккаунту пользователя. Этот секрет должен быть известен только вашему приложению и сервису API.

Пояснение: Т.е. это что-то вроде логина и пароля, с помощью которых наше приложение будет ходить в сервер авторизации.

---

### Виды OAuth-2.0. авторизации

Система OAuth 2 предоставляет четыре различных вида запроса авторизации, и их выбор зависит от конкретных сценариев использования:

1. **Authorization Code Flow** (Код авторизации). Этот метод чаще всего используется в серверных приложениях (т.е. на бэкенде), где безопасность имеет большое значение. Приложение запрашивает код авторизации, который затем обменивается на токен доступа.

2. **Implicit Flow** (Неявный). Подходит для мобильных приложений, включая их веб-версии. В этом случае приложение получает токен доступа непосредственно после авторизации пользователя, не требуя дополнительного обмена кодом.

3. **Resource Owner Password Flow ** (Учетные данные владельца). Включает в себя предоставление учетных данных (логина и пароля) доверенным приложениям, которые имеют полный доступ к аккаунту пользователя. Этот метод полезен для приложений, которые интегрируются напрямую в онлайн-сервис.

4. **Client Credentials Flow** (Учетные данные клиента). Используется, когда приложение работает от имени самого приложения, а не от имени конкретного пользователя. Он обеспечивает доступ к ресурсам через API без привлечения конечного пользователя.

Разберем только 2 основных:  **Authorization Code Flow** и  **Implicit Flow**

---

### OAuth-2.0. - Authorization Code Flow

![[Pasted image 20240526235408.png]]

----

В контексте приложения на Spring Boot, использующего Google для аутентификации, эти термины означают следующее:

1. **Resource Owner** (владелец ресурса) - это пользователь, который имеет доступ к защищенным ресурсам и может разрешить третьим лицам (клиентам) получить доступ к этим ресурсам. В контексте Google, это пользователь Google, который может разрешить вашему приложению получить доступ к его данным, например, к его календарю или контактам.
    
2. **Client** (клиент) - это приложение, которое запрашивает доступ к защищенным ресурсам владельца ресурса. В вашем случае, это приложение на Spring Boot, которое хочет получить доступ к данным пользователя Google.
    
3. **Authorization Server** (сервер авторизации) - это сервер, который проверяет удостоверения пользователя и выдает токены доступа клиенту. В случае с Google, это сервер, который обрабатывает запросы на аутентификацию и авторизацию от вашего приложения.
    
4. **Resource Server** (сервер ресурсов) - это сервер, который хранит защищенные ресурсы и принимает и проверяет токены доступа, выданные сервером авторизации. Для Google это сервер, который хранит данные пользователя и предоставляет доступ к ним через API.
    
5. **Redirect URI/Callback URL** (URI перенаправления/URL обратного вызова) - это URL, на который сервер авторизации перенаправляет пользователя после успешной аутентификации и авторизации. Этот URL должен быть предварительно зарегистрирован в клиентском приложении и сервере авторизации.
    
6. **Response Type** (тип ответа) - это параметр, указывающий серверу авторизации, какой тип авторизации требуется клиенту. Например, `code` для получения кода авторизации, который затем обменивается на токен доступа.
    
7. **Scope** (область) - это набор прав, которые клиент запрашивает у владельца ресурса. Это определяет, какие конкретные данные или действия клиент может выполнять. Например, доступ к электронной почте, календарю или контактам.
    
8. **Consent** (согласие) - это процесс, при котором владелец ресурса подтверждает, что он согласен с тем, что клиент получит доступ к определенным ресурсам в определенной области. Это важный аспект OAuth 2.0, обеспечивающий согласие пользователя на доступ к его данным.

9. **Access Token** (токен доступа) - это строка, которая представляет разрешение клиенту на доступ к защищенным ресурсам на сервере ресурсов. Токен доступа выдается сервером авторизации после успешной аутентификации и авторизации пользователя. В случае с Google, этот токен позволяет вашему приложению читать или изменять данные пользователя в рамках определенной области (scope), например, читать его электронную почту или изменять календарь. Токен доступа имеет ограниченный срок действия, обычно от нескольких минут до нескольких часов.
    
10. **Refresh Token** (токен обновления) - это другой тип токена, который выдается сервером авторизации вместе с токеном доступа. Токен обновления используется для получения нового токена доступа после истечения срока его действия. Это позволяет клиенту продолжать доступ к ресурсам без необходимости повторной аутентификации пользователя. В случае с Google, если токен доступа истек, ваше приложение может использовать токен обновления для получения нового токена доступа без участия пользователя. Токен обновления обычно имеет более длительный срок действия или может быть бессрочным, пока пользователь не отозвал согласие.


